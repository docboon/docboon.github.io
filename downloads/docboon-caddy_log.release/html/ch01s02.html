<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>2.&nbsp;caddy&#26085;&#24535;&#27010;&#35272;</title><link rel="stylesheet" type="text/css" href="themes/default/style/style.css"><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><style type="text/css">
body { background-image: url('themes/default/style/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style><link rel="home" href="index.html" title="Caddy&#26085;&#24535;&#21442;&#32771;&#25163;&#20876;"><link rel="up" href="ch01.html" title="&#31532;&nbsp;1&nbsp;&#31456;&nbsp;&#20851;&#20110;caddy"><link rel="prev" href="ch01.html" title="&#31532;&nbsp;1&nbsp;&#31456;&nbsp;&#20851;&#20110;caddy"><link rel="next" href="ch02.html" title="&#31532;&nbsp;2&nbsp;&#31456;&nbsp;&#37197;&#32622;(Caddyfile&#20013;&#26085;&#24535;&#30340;&#37197;&#32622;)"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.&nbsp;caddy&#26085;&#24535;&#27010;&#35272;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch01.html"><img src="themes/default/navig/prev.png" alt="&#19978;&#19968;&#39029;"></a>&nbsp;</td><th width="60%" align="center">&#31532;&nbsp;1&nbsp;&#31456;&nbsp;&#20851;&#20110;caddy</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch02.html"><img src="themes/default/navig/next.png" alt="&#19979;&#19968;&#39029;"></a></td></tr></table></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e223"></a>2.&nbsp;caddy&#26085;&#24535;&#27010;&#35272;</h2></div></div></div><p>caddy&#30340;&#26085;&#24535;&#22312;&#35774;&#35745;&#19978;&#19982;httpd&#21450;nginx&#31561;&#21069;&#36744;&#26377;&#19968;&#20123;&#19981;&#22826;&#19968;&#26679;&#30340;&#22320;&#26041;&#65292;httpd&#21644;nginx&#40664;&#35748;&#24773;&#20917;&#19979;&#20351;&#29992;&#20102;<span class="emphasis"><em>Common Log Format(CLF)</em></span>&#21644;<span class="emphasis"><em>Combined Log Format(Combined)</em></span>&#26085;&#24535;&#26684;&#24335;&#12290;&#32780;caddy&#20351;&#29992;&#20102;json&#25991;&#20214;&#26684;&#24335;&#26469;&#35760;&#24405;&#26085;&#24535;&#65292;&#32780;&#19988;&#23383;&#27573;&#20063;&#35201;&#22810;&#20986;&#24456;&#22810;&#12290;caddy&#30340;&#26085;&#24535;&#35774;&#35745;&#24102;&#26377;&#20102;&#35768;&#22810;&#8220;&#22823;&#25968;&#25454;&#8221;&#26041;&#38754;&#30340;&#29702;&#24565;&#65306;</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">&#26085;&#24535;&#25968;&#25454;&#21450;&#26085;&#24535;&#26465;&#30446;&#20013;&#30340;&#23383;&#27573;&#36234;&#22810;&#36234;&#22909;</li><li class="listitem">&#23545;&#26085;&#24535;&#36827;&#34892;&#36807;&#28388;&#28165;&#27927;&#21518;&#20445;&#23384;&#27604;&#30452;&#25509;&#20002;&#24323;&#22909;</li><li class="listitem">&#21512;&#36866;&#30340;&#32534;&#30721;&#26684;&#24335;&#20197;&#25552;&#39640;&#26085;&#24535;&#25968;&#25454;&#30340;&#28789;&#27963;&#24615;&#21644;&#20132;&#20114;&#33021;&#21147;</li></ol></div><p>&#22312;caddy&#30340;&#23448;&#32593;&#26377;&#19968;&#31687;&#23567;&#25991;&#31456;&#65292;&#31616;&#21333;&#20171;&#32461;&#20102;&#20854;&#26085;&#24535;&#31995;&#32479;&#30340;&#29702;&#24565;&#65306;<a class="link" href="https://caddyserver.com/docs/logging" target="_top">https://caddyserver.com/docs/logging</a>&#65292;&#21253;&#25324;caddy&#22312;&#26085;&#24535;&#31995;&#32479;&#20013;&#30340;&#35282;&#33394;&#12289;caddy&#26085;&#24535;&#30340;&#32467;&#26500;&#12289;&#22788;&#29702;&#27969;&#31243;&#21450;&#26085;&#24535;&#30340;&#20351;&#29992;&#31561;&#12290;</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d0e245"></a>2.1.&nbsp;caddy&#22312;&#26085;&#24535;&#31995;&#32479;&#20013;&#30340;&#35282;&#33394;</h3></div></div></div><p>&#36890;&#24120;&#24773;&#20917;&#19979;&#65292;&#22312;&#26085;&#24535;&#31995;&#32479;&#21253;&#21547;&#20004;&#26041;&#38754;&#20027;&#35201;&#30340;&#20869;&#23481;&#65306;emission&#65288;&#20135;&#29983;&#26085;&#24535;&#65289;&#21644; consumption&#65288;&#20351;&#29992;&#65289;</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><span class="emphasis"><em>Emission</em></span>&#65306;&#24847;&#21619;&#30528;&#20135;&#29983;&#26085;&#24535;&#20449;&#24687;&#65292;&#23427;&#36890;&#24120;&#21253;&#21547;&#19977;&#20010;&#27493;&#39588;&#65306;
          <div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">&#25910;&#38598;&#30456;&#20851;&#30340;&#20449;&#24687;&#65307;</li><li class="listitem">&#25353;&#29031;&#19968;&#23450;&#30340;&#26684;&#24335;&#23545;&#20449;&#24687;&#36827;&#34892;&#23553;&#35013;&#65307;</li><li class="listitem">&#23558;&#23553;&#35013;&#22909;&#30340;&#20449;&#24687;&#21457;&#36865;&#21040;&#36866;&#24403;&#30340;&#22320;&#26041;&#12290;</li></ol></div><p>&#36825;&#19977;&#20010;&#37096;&#20998;&#30340;&#21151;&#33021;&#24050;&#32463;&#21253;&#21547;&#22312;caddy&#30340;&#26680;&#24515;&#20195;&#30721;&#20013;&#65292;&#20219;&#20309;&#30340;&#27169;&#22359;&#21644;&#25554;&#20214;&#37117;&#21487;&#20197;&#35843;&#29992;&#36825;&#37096;&#20998;&#21151;&#33021;&#12290;</p></li><li class="listitem"><span class="emphasis"><em>consumption</em></span>&#65306;&#26085;&#24535;&#30340;&#20351;&#29992;&#21644;&#22788;&#29702;&#12290;&#27809;&#26377;&#34987;&#20351;&#29992;&#30340;&#26085;&#24535;&#26159;&#27809;&#26377;&#20219;&#20309;&#20215;&#20540;&#30340;&#12290;&#21482;&#26377;&#27491;&#30830;&#30340;&#20351;&#29992;&#26085;&#24535;&#65292;&#25165;&#33021;&#20351;&#20854;&#20135;&#29983;&#24212;&#26377;&#30340;&#20215;&#20540;&#12290;
        </li></ol></div><p>&#22312;&#36825;&#20004;&#20010;&#27010;&#24565;&#37324;&#65292;caddy&#23646;&#20110;&#21069;&#32773;&#65292;&#26159;&#19968;&#20010;&#26085;&#24535;&#29983;&#20135;&#32773;&#12290;</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d0e270"></a>2.2.&nbsp;caddy&#32467;&#26500;&#21270;&#30340;&#26085;&#24535;</h3></div></div></div><p>caddy&#37319;&#29992;&#20102;&#26356;&#20026;&#32467;&#26500;&#21270;&#30340;&#26085;&#24535;&#31995;&#32479;&#65292;JSON&#26684;&#24335;&#30340;&#26085;&#24535;&#26159;caddy&#27604;&#36739;&#24314;&#35758;&#20351;&#29992;&#30340;&#26684;&#24335;&#12290;&#22914;&#26524;&#19981;&#24819;&#20351;&#29992;JSON&#26684;&#24335;&#65292;&#20063;&#21487;&#20197;&#22312;&#37197;&#32622;&#25991;&#20214;&#20013;&#20351;&#29992;<span class="command"><strong>encoder</strong></span>&#25351;&#20196;&#26469;&#25351;&#23450;&#20854;&#20182;&#30340;&#26684;&#24335;&#12290;&#22914;&#19979;&#30340;&#20869;&#23481;&#26159;caddy&#23448;&#26041;&#32593;&#31449;&#25152;&#23637;&#31034;&#30340;&#19968;&#27573;JSON&#26684;&#24335;&#30340;&#26085;&#24535;&#20869;&#23481;&#65306;</p><pre class="programlisting">&nbsp;&nbsp;1 {
&nbsp;&nbsp;2 	"level": "info",
&nbsp;&nbsp;3 	"ts": 1585597114.7687502,
&nbsp;&nbsp;4 	"logger": "http.log.access",
&nbsp;&nbsp;5 	"msg": "handled request",
&nbsp;&nbsp;6 	"request": {
&nbsp;&nbsp;7 		"method": "GET",
&nbsp;&nbsp;8 		"uri": "/",
&nbsp;&nbsp;9 		"proto": "HTTP/2.0",
&nbsp;10 		"remote_addr": "127.0.0.1:50876",
&nbsp;11 		"host": "example.com",
&nbsp;12 		"headers": {
&nbsp;13 			"User-Agent": [	"curl/7.64.1"],
&nbsp;14 			"Accept": ["*/*"]
&nbsp;15 		},
&nbsp;16 		"tls": {
&nbsp;17 			"resumed": false,
&nbsp;18 			"version": 771,
&nbsp;19 			"ciphersuite": 49196,
&nbsp;20 			"proto": "h2",
&nbsp;21 			"proto_mutual": true,
&nbsp;22 			"server_name": "example.com"
&nbsp;23 		}
&nbsp;24 	},
&nbsp;25 	"user_id": "",
&nbsp;26 	"duration": 0.000014711,
&nbsp;27 	"size": 2326,
&nbsp;28 	"status": 200,
&nbsp;29 	"resp_headers": {
&nbsp;30 		"Server": ["Caddy"],
&nbsp;31 		"Content-Type": ["text/html"]
&nbsp;32 	}
&nbsp;33 }</pre></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a name="d0e282"></a>2.3.&nbsp;&#22788;&#29702;&#27969;&#31243;</h3></div></div></div><p>caddy&#20013;&#22788;&#29702;log&#30340;&#31243;&#24207;&#31216;&#20026;<span class="emphasis"><em>logger</em></span>&#65292;&#26085;&#24535;&#20449;&#24687;&#34987;<span class="emphasis"><em>logger</em></span>&#25910;&#38598;&#24182;&#21457;&#36865;&#21040;<span class="emphasis"><em>log</em></span>&#36827;&#34892;&#22788;&#29702;&#65292;caddy&#20801;&#35768;&#37197;&#32622;&#22810;&#20010;<span class="emphasis"><em>log</em></span>s&#12290;&#19968;&#20010;<span class="emphasis"><em>log</em></span>&#21253;&#21547;&#22914;&#19979;&#20960;&#20010;&#37096;&#20998;&#65306;</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><span class="emphasis"><em>encoder</em></span><p>&#26085;&#24535;&#37319;&#29992;&#30340;&#32534;&#30721;&#26684;&#24335;&#65292;&#21253;&#25324;<code class="option">console</code>&#12289;<code class="option">json</code>&#12289;<code class="option">filter</code>&#21450;<code class="option">single_field</code>&#31561;&#12290;</p></li><li class="listitem"><span class="emphasis"><em>writer</em></span><p>&#37197;&#32622;&#26085;&#24535;&#36755;&#20986;&#30340;&#22320;&#26041;&#12290;&#21487;&#20197;&#26159;&#19968;&#20010;&#25991;&#20214;&#20063;&#21487;&#20197;&#26159;&#19968;&#20010;&#32593;&#32476;&#22320;&#22336;&#12290;</p></li><li class="listitem"><span class="emphasis"><em>level</em></span><p>&#26085;&#24535;&#30340;&#32423;&#21035;&#65292;&#20174;DEBUG&#21040;FATAL&#65292;&#40664;&#35748;&#26159;INFO&#12290;</p></li><li class="listitem"><span class="emphasis"><em>sampling</em></span><p>&#26085;&#24535;&#37319;&#26679;&#30340;&#39057;&#29575;&#12290;</p></li><li class="listitem"><span class="emphasis"><em>include/exclude</em></span><p>&#27599;&#19968;&#26465;&#20449;&#24687;&#37117;&#26159;&#34987;&#19968;&#20010;<span class="emphasis"><em>logger</em></span>&#25152;&#21457;&#20986;&#65292;&#36825;&#20010;<span class="emphasis"><em>logger</em></span>&#26377;&#19968;&#20010;&#21517;&#23383;&#65292;&#36890;&#24120;&#26159;&#20449;&#24687;&#25152;&#22312;&#27169;&#22359;&#30340;&#21517;&#31216;&#65292;&#20351;&#29992;<code class="option">include/exclude</code>&#26426;&#21046;&#65292;&#22312;&#35760;&#24405;&#26085;&#24535;&#26102;&#21487;&#20197;&#21253;&#21547;&#25110;&#25490;&#38500;&#26576;&#20123;&#25351;&#23450;&#30340;&#27169;&#22359;&#12290;</p></li></ol></div></div></div><div class="navfooter"><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch01.html"><img src="themes/default/navig/prev.png" alt="&#19978;&#19968;&#39029;"></a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch01.html"><img src="themes/default/navig/up.png" alt="&#19978;&#19968;&#32423;"></a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch02.html"><img src="themes/default/navig/next.png" alt="&#19979;&#19968;&#39029;"></a></td></tr><tr><td width="40%" align="left" valign="top">&#31532;&nbsp;1&nbsp;&#31456;&nbsp;&#20851;&#20110;caddy&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="themes/default/navig/home.png" alt="&#36215;&#22987;&#39029;"></a></td><td width="40%" align="right" valign="top">&nbsp;&#31532;&nbsp;2&nbsp;&#31456;&nbsp;&#37197;&#32622;(Caddyfile&#20013;&#26085;&#24535;&#30340;&#37197;&#32622;)</td></tr></table></div></body></html>